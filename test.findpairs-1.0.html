<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/spruits-2018.9.css">
<style id="spruits-app-styles">
</style>
<title>Find Pairs, v1.0</title>
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/spruits2.js"></script>
<script>
"use strict"
$(document).ready(function(){

function Card(args) {
  let faceValue = args.faceValue,
      onClick =   args.onClick,
      $label;
  
  spruits2.Component.call(this, args);
  $label = this.$label;
  $label.html(faceValue);
  this.$field.addClass("card");
  this.$field.on("click", e => onClick(e, $label));
}
spruits2.addCssRule(`.spruit-field.card > label {
  width: 3em;
  height: 2.5em;
  padding-top:0.5em;
  text-align: center;
  border: 0;
  margin: 0.5em;
  border-radius: 8px;
  background: #ffff00;
  border-right: 1px solid #999900;
  border-bottom: 1px solid #999900;
  color: #333300;
}
.spruit-field.card > label.facedown {
  background: #999900;
  color: #999900;
  border-right-color: #ffff00;
  border-bottom-color: #ffff00;
}
.spruit-field.card > label.removed {
  background: #9ACD32;
  color: #9ACD32;
  border-right-color: #9ACD32;
  border-bottom-color: #9ACD32;
}`);
function(args) {
  let pairList = [ "a", "b", "c", "d" ],
      $board = $("<div>", { class:"board" }),
      faceUp = [],
      
      shuffleCards = function(numPairs) {
	let cardId = [ 1, 2 ],
	    alreadySet = {},
	    boardSize = 2*numPairs,
	    board = Array(boardSize).fill(null),
	    i;
	
	pairList.forEach(pairName => {
	  cardId.forEach(id => {
	    for (;;) {
	      i = Math.floor(Math.random() * boardSize); // i = integer [0 - (boardSize-1)]
	      if (alreadySet["" + i] !== true) {
		alreadySet["" + i] = true;
		board[i] = pairName + id;
		break;
	      }
	    } // for(;;)
	  });
	});
	
	return board;
      },

      playGame = function(e, $label) {
	let turned = false;
	
	e.preventDefault();
	
	if (faceUp.length < 2 && $label.hasClass("facedown")) {
	  $label.removeClass("facedown");
	  faceUp.push($label);
	  turned = true;
	}
	
	if (faceUp.length > 1) {
	  /* two cards are face-up */
	  
	  if (faceUp[0].html() === faceUp[1].html()) {
	    /* pair found */
	    faceUp.forEach($label => $label.addClass("removed"));
	    faceUp = [];
	  } else {
	    /* not a pair */
	    
	    if (turned === false) {
	      /* return cards back to the face-down state */
	      faceUp.forEach($label => $label.addClass("facedown"));
	      faceUp = [];
	    }
	  }
	}
      };
  
  spruits2.Component.call(this, args);
  spruits2.Container.call(this, this.name);

  /* Create pairs and store them to fields-property. */
  pairList.forEach(card => {
    this.createField(card + "1", Card, { faceValue:card, pairId:"1", attrs:{ label:{ class:"facedown" }}, onClick:playGame });
    this.createField(card + "2", Card, { faceValue:card, pairId:"2", attrs:{ label:{ class:"facedown" }}, onClick:playGame });
  });

  /* shuffleCards returns an array which contains the fieldNames of the cards in random order. 
   * Cards are placed to the board in that order by the Array.map-method.
   */
  $board.append( shuffleCards(pairList.length).map(cardName => this.fields[cardName].$field) );
  this.$field.addClass("findpairs").append($board);
} // FindPairs

spruits2.addCssRule(`.spruit-field.findpairs .board {
  background-color: #9ACD32;
  margin: 1em;
  padding:1em;
}`);
$("body").append($("<div>", { class:"page slideIn"}).append("<h4>Find Pairs, v1.0</h4>", (new FindPairs({})).$field));

}); //document.ready
</script>
</head>
<body>
</body>
</html>
